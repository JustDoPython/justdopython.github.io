---
layout: post
category: python
title: 第100天： 三木板模型算法项目实战
tagline: by 戴景波
tags: 
  - python100
---

## 机器学习

本篇同样是机器学习，但没有用到python中已有的算法和函数。

这篇机器学习建模的思路比较新颖，模型评估也比较独特。旨在引导广大读者借鉴，举一反三。

只是通过足球领域举例，可扩展到其他任何领域，达到抛砖引玉的目的。

<!--more-->

## 机器学习,通过爬取的数据进行建模

建模思路：选取三家菠菜公司的主队胜赔率（每个公司都会给出初始胜、平、负三个赔率）作为组合对象与历史数据的三家赔率组合比较，

统计出历史比赛结果标签y/n的数量，y代表主队获胜，n代表主队不胜。

并输出符合条件“y>n*3或n>y*3”的结果（3为参数，目前尚未调整过此参数，可根据算法模型及评估结果适时调整）。

举例：以下是爬虫爬取的历史数据，每个值都是公司给出的主队第一个赔率也就是获胜的赔率：

下边是未来要预测的一场比赛：

20190920周四    2.14  2.15   2.1   2.1   2.2   2.1   2.08   2.12    欧联杯

## 机器学习思路：

选取未来这场比赛中8个特征中的任何三个特征组合（如2.14,2.15,2.1）与历史数据所有行中对应特征（易胜博、立博、bet365）组合进行比对，

发现三个特征值完全相同就统计res列比赛结果y或n的数量。循环其他任意三个特征组合，直到取完C83种组合为止。

如果历史数据中存在组合对象结果y大于3倍的n时，记录。或n大于3倍的y时，也同样记录。最后根据综合结果来预测未来的这场比赛可能出现的比赛结果。

res	信心指数	预测结果	2018.1-至今历史数据	2018.1-至今:欧洲数据	2018.5-至今
y	1.34 	 	  y								,lw10_yes_8_2

以上边未来预测的那场比赛为例，res是实际比赛结果，最后三列是计算结果，其中最后一列得到的结果是lw10_yes_8_2，那么yes代表主队获胜，在预测结果列输出y，获胜的信心指数为（8-2X3）*权重，权重会在下边评估模型中讲到。

## 评估模型

评估模型的建立是为了对建立的机器学习模型进行有效评估，对预测正确的部分进行加强学习，对预测错误的部分进行权重调整，从而达到完善模型的目的。

建立评估模型，旨在选择信心场次，原理：列出所有C83共56种组合对象，每一列代表一个组合。用正向激励和反向激励统计出哪些组合对比赛结果有较大的影响，作为今后选择信心场次的优先依据。

第一行为赔率组合（56个组合）；第二行为正向激励数量，即预测结果正确时各个赔率组合的数量，此时场次对应的值为正数，

如第四行的3、1、1，计算公式为历史数据中比赛结果标签y/n中“多”的数量减去3倍“少”的数量C多-C少*3。

此外，第二行E列373的公式求和为“=SUM(E4:E65471)”；第三行为反向激励数量，即预测结果错误时各个赔率组合的数量，

此时场次对应的值为负数；如第九行的-4、-3，计算公式为历史数据中比赛结果标签y/n中多的数量减去3倍少的数量取负值。-（C多-C少*3）。

第三行E列87的公式为“=COUNTIF(E4:E65471,"<0")”，即取小于0的行数。
	结果	pre-ok		sum	ol5	olin	olwl	olw	olao	ol10	o5in	o5wl ...
Sum(正向激励)	1为预测正确		373	293	451	363	138	457	353	391
<0（反向激励）				87	50	67	65	31	61	55	87
20190224周日030	y	1	11				3	1			1
		y		11				5				1
		y		9				2	2			1
20190224周日027	y	0	-19								
		y		-15								
		y		-24			-4			-3		

为进一步量化模型，新增了信心指数中的权重：权重=（>0的数量/sum总数）

res	信心指数	预测结果	2018.1-至今历史数据	2018.1-至今:欧洲数据	2018.5-至今
y	1.34 	y			,lw10_yes_8_2
y	9.10 	y	,iw10_yes_6_0	,iw10_yes_4_0	,iw10_yes_4_0

changci 	lw10	liao10	5inwl	5inw	5inao	5wlw	5in10	...
sum	151	62	220	279	66	468	166	
>0	133	41	143	173	47	237	116	
<0	65	13	49	74	15	96	57	
权重（>0的数量/总数量）	0.67	0.76 	0.74 	0.70	0.76	0.71 	0.67	

以第一行为例，这场比赛的信心指数={历史数据中主队获胜数量-（主队不胜的数量*3） * 对应的权重}：（8-2X3）X 0.67 = 1.34。

评估模型能够进一步量化数据从而得出权重，而这个权重是随着历史数据增加而实时调整的。

所以模型评估对于机器学习非常重要，主要起两个作用：第一、量化权重；第二、反向传播思想改善模型。本篇就很好的完成了这两个作用。

## 总结

本篇提出了新颖的机器学习预测中的建模思想——三木板模型（已在国家期刊发表论文并被万方数据库收录，三木板模型算法论文地址：http://wanfangdata.com.cn 搜索“基于机器学习的预测算法模型及其在环评领域的应用”），

并提出了评估模型的思路，对于足球领域之外的其他领域也非常有借鉴意义。

## 代码地址



> 示例代码：[Python-100-days-day100](https://github.com/JustDoPython/python-100-day/tree/master/day-100)

